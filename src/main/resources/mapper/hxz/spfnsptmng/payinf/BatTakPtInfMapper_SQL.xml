<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tmoney.co.kr.hxz.spfnsprtmng.payinf.mapper.BatTakPtInfMapper">

    <!-- ========================================= -->
    <!-- 배치작업 포인트 정보 리스트 조회 (서브쿼리 + 동적 조건 + 정렬/페이징) -->
    <!-- ========================================= -->
    <select id="readBatTakPtInfList"
            resultType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfRspVO"
            parameterType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfReqVO">

        select
        bat.bat_tak_dt      as batTakDt,
        bat.bat_tak_id      as batTakId,
        bat.bat_prcg_sta_cd as batPrcgStaCd,
        bat.bat_tak_stt_dtm as batTakSttDtm,
        bat.bat_tak_end_dtm as batTakEndDtm
        from (
        select
        to_date(d200.bat_tak_dt, 'YYYYMMDD') as bat_tak_dt,
        d200.bat_tak_id,
        d200.bat_prcg_sta_cd,
        d200.bat_tak_stt_dtm as bat_tak_stt_dtm,
        d200.bat_tak_end_dtm as bat_tak_end_dtm
        from tbhxzd200 d200
        <where>
            1=1
            <if test="req.sttDt != null and req.sttDt != '' and req.endDt != null and req.endDt != ''">
                and d200.bat_tak_dt between replace(#{req.sttDt}, '-', '') and replace(#{req.endDt}, '-', '')
            </if>
            <!-- 이거 req에 없음 -->
            <!-- <if test="req.batPrcgStaCd != null and req.batPrcgStaCd != ''">
                and d200.bat_prcg_sta_cd = #{req.batPrcgStaCd}
            </if> -->
            <!-- 이거 req에 없음 -->
            <!-- <if test="req.batTakId != null and req.batTakId != ''">
                and d200.bat_tak_id = #{req.batTakId}
            </if> -->
        </where>
        ) bat
        order by ${req.sort} ${req.dir}
        limit #{req.size} offset #{req.page}

    </select>

    <!-- ========================================= -->
    <!-- 배치작업 포인트 정보 총 건수 조회 (동적 조건 적용) -->
    <!-- ========================================= -->
    <select id="readBatTakPtInfListCnt"
            parameterType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfReqVO"
            resultType="long">

        select count(1)
        from tbhxzd200 d200
        <where>
            1=1
            <if test="req.sttDt != null and req.sttDt != '' and req.endDt != null and req.endDt != ''">
                and d200.bat_tak_dt between replace(#{req.sttDt}, '-', '') and replace(#{req.endDt}, '-', '')
            </if>
            <!-- 이거 req에 없음 -->
            <!-- <if test="req.batPrcgStaCd != null and req.batPrcgStaCd != ''">
                and d200.bat_prcg_sta_cd = #{req.batPrcgStaCd}
            </if> -->
            <!-- 이거 req에 없음 -->
            <!-- <if test="req.batTakId != null and req.batTakId != ''">
                and d200.bat_tak_id = #{req.batTakId}
            </if> -->
        </where>

    </select>

</mapper>
