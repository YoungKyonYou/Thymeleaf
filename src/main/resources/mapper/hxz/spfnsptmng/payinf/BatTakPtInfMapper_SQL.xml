<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tmoney.co.kr.hxz.spfnsprtmng.payinf.mapper.BatTakPtInfMapper">

    <!-- ========================================= -->
    <!-- 배치작업 포인트 정보 리스트 조회 (서브쿼리 + 동적 조건 + 정렬/페이징) -->
    <!-- ========================================= -->
    <select id="readBatTakPtInfList"
            resultType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfRspVO"
            parameterType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfReqVO">

        select
        bat.bat_tak_dt      as batTakDt,
        bat.bat_tak_id      as batTakId,
        bat.bat_prcg_sta_cd as batPrcgStaCd,
        bat.bat_tak_stt_dtm as batTakSttDtm,
        bat.bat_tak_end_dtm as batTakEndDtm
        from (
        select
        to_char(to_date(d200.bat_tak_dt, 'YYYYMMDD'), 'YYYY-MM-DD') as bat_tak_dt,
        d200.bat_tak_id,
        d200.bat_prcg_sta_cd,
        to_char(d200.bat_tak_stt_dtm, 'YYYY-MM-DD HH24:MI:SS') as bat_tak_stt_dtm,
        to_char(d200.bat_tak_end_dtm, 'YYYY-MM-DD HH24:MI:SS') as bat_tak_end_dtm
        from tbhxzd200 d200
        <where>
            1=1
            <if test="sttDt != null and sttDt != '' and endDt != null and endDt != ''">
                and d200.bat_tak_dt between replace(#{sttDt}, '-', '') and replace(#{endDt}, '-', '')
            </if>
            <if test="batPrcgStaCd != null and batPrcgStaCd != ''">
                and d200.bat_prcg_sta_cd = #{batPrcgStaCd}
            </if>
            <if test="batTakId != null and batTakId != ''">
                and d200.bat_tak_id = #{batTakId}
            </if>
        </where>
        ) bat
        order by ${sort} ${dir}
        limit #{size} offset #{page}

    </select>

    <!-- ========================================= -->
    <!-- 배치작업 포인트 정보 총 건수 조회 (동적 조건 적용) -->
    <!-- ========================================= -->
    <select id="readBatTakPtInfListCnt"
            parameterType="tmoney.co.kr.hxz.spfnsprtmng.payinf.vo.BatTakPtInfReqVO"
            resultType="long">

        select count(1)
        from tbhxzd200 d200
        <where>
            1=1
            <if test="sttDt != null and sttDt != '' and endDt != null and endDt != ''">
                and d200.bat_tak_dt between replace(#{sttDt}, '-', '') and replace(#{endDt}, '-', '')
            </if>
            <if test="batPrcgStaCd != null and batPrcgStaCd != ''">
                and d200.bat_prcg_sta_cd = #{batPrcgStaCd}
            </if>
            <if test="batTakId != null and batTakId != ''">
                and d200.bat_tak_id = #{batTakId}
            </if>
        </where>

    </select>

</mapper>
